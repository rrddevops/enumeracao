#!/bin/bash

echo "üîß Iniciando instala√ß√£o das ferramentas de enumera√ß√£o..."
echo "=================================================="

# Atualizar sistema
echo "[1/10] Atualizando sistema..."
sudo apt update && sudo apt upgrade -y

# Instalar depend√™ncias b√°sicas
echo "[2/10] Instalando depend√™ncias b√°sicas..."
sudo apt install -y \
  python3 \
  python3-pip \
  git \
  wget \
  curl \
  unzip \
  golang-go \
  ruby-full \
  nmap \
  whatweb \
  fierce \
  dnsrecon \
  dnsenum \
  dirb \
  gobuster \
  masscan \
  dnswalk \
  seclists \
  chromium-browser \
  build-essential \
  libpcap-dev \
  libssl-dev \
  zlib1g-dev \
  libbz2-dev \
  libreadline-dev \
  libsqlite3-dev \
  libncurses5-dev \
  libncursesw5-dev \
  xz-utils \
  tk-dev \
  libffi-dev \
  liblzma-dev \
  libgdbm-dev \
  libnss3-dev \
  libatk-bridge2.0-dev \
  libgtk-3-dev \
  libxss-dev

# Configurar Go
echo "[3/10] Configurando Go..."
export GOPATH=$HOME/go
export PATH=$PATH:$GOPATH/bin
echo 'export GOPATH=$HOME/go' >> ~/.bashrc
echo 'export PATH=$PATH:$GOPATH/bin' >> ~/.bashrc
source ~/.bashrc

# Instalar ferramentas Python
echo "[4/10] Instalando ferramentas Python..."
pip3 install --upgrade pip
pip3 install \
  ffuf \
  gowitness \
  nuclei \
  metagoofil \
  theHarvester \
  git-secrets \
  subjack \
  dalfox \
  paramspider \
  xsstrike \
  by4xx \
  waybackpacket \
  ctfr \
  dnsvalidator \
  sublist3r \
  assetfinder \
  findomain \
  httpx \
  gau \
  waybackurls \
  hakrawler \
  gospider \
  meg \
  waymore \
  unfurl \
  recon-ng \
  spiderfoot \
  shodan \
  censys \
  wafw00f \
  vhost \
  mapcidr \
  tko-subs \
  github-dorker \
  gfredirect

# Instalar ferramentas Go
echo "[5/10] Instalando ferramentas Go..."
go install github.com/tomnomnom/gf@latest
go install github.com/tomnomnom/waybackurls@latest
go install github.com/tomnomnom/gau@latest
go install github.com/projectdiscovery/httpx/cmd/httpx@latest
go install github.com/projectdiscovery/nuclei/v2/cmd/nuclei@latest
go install github.com/hakluke/hakrawler@latest
go install github.com/OWASP/Amass/v4/...@latest
go install github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
go install github.com/projectdiscovery/shuffledns/cmd/shuffledns@latest
go install github.com/projectdiscovery/dnsx/cmd/dnsx@latest
go install github.com/projectdiscovery/naabu/v2/cmd/naabu@latest
go install github.com/toniblyx/gitrob@latest
go install github.com/greenbone/gospider@latest
go install github.com/projectdiscovery/mapcidr/cmd/mapcidr@latest

# Instalar ferramentas espec√≠ficas
echo "[6/10] Instalando ferramentas espec√≠ficas..."

# Metabigor (tentar com git clone p√∫blico)
echo "Instalando Metabigor..."
if git clone https://github.com/j3ssie/metabigor.git 2>/dev/null; then
    cd metabigor && chmod +x metabigor && sudo cp metabigor /usr/local/bin && cd ..
    echo "‚úÖ Metabigor instalado com sucesso"
else
    echo "‚ö†Ô∏è Metabigor n√£o p√¥de ser instalado via git, tentando download direto..."
    wget -O metabigor https://github.com/j3ssie/metabigor/releases/latest/download/metabigor_linux_amd64 2>/dev/null || echo "‚ö†Ô∏è Metabigor n√£o dispon√≠vel"
    if [ -f metabigor ]; then
        chmod +x metabigor && sudo mv metabigor /usr/local/bin/
        echo "‚úÖ Metabigor instalado via download"
    fi
fi

# Massdns
echo "Instalando Massdns..."
if git clone https://github.com/blechschmidt/massdns.git 2>/dev/null; then
    cd massdns && make && sudo cp bin/massdns /usr/local/bin && cd ..
    echo "‚úÖ Massdns instalado com sucesso"
else
    echo "‚ö†Ô∏è Massdns n√£o p√¥de ser instalado"
fi

# Kiterunner
echo "Instalando Kiterunner..."
if git clone https://github.com/assetnote/kiterunner.git 2>/dev/null; then
    cd kiterunner && ./install.sh && cd ..
    echo "‚úÖ Kiterunner instalado com sucesso"
else
    echo "‚ö†Ô∏è Kiterunner n√£o p√¥de ser instalado"
fi

# Cloud_enum
echo "Instalando Cloud_enum..."
if git clone https://github.com/initstring/cloud_enum.git 2>/dev/null; then
    cd cloud_enum && pip3 install -r requirements.txt && cd ..
    echo "‚úÖ Cloud_enum instalado com sucesso"
else
    echo "‚ö†Ô∏è Cloud_enum n√£o p√¥de ser instalado"
fi

# Arjun
echo "Instalando Arjun..."
if git clone https://github.com/s0md3v/Arjun.git 2>/dev/null; then
    cd Arjun && pip3 install -r requirements.txt && cd ..
    echo "‚úÖ Arjun instalado com sucesso"
else
    echo "‚ö†Ô∏è Arjun n√£o p√¥de ser instalado"
fi

# Xray
echo "Instalando Xray..."
wget https://github.com/chaitin/xray/releases/download/1.9.13/xray_linux_amd64.zip 2>/dev/null
if [ -f xray_linux_amd64.zip ]; then
unzip xray_linux_amd64.zip
chmod +x xray
sudo mv xray /usr/local/bin/
    rm xray_linux_amd64.zip
    echo "‚úÖ Xray instalado com sucesso"
else
    echo "‚ö†Ô∏è Xray n√£o p√¥de ser baixado"
fi

# WPScan
echo "Instalando WPScan..."
sudo gem install wpscan 2>/dev/null && echo "‚úÖ WPScan instalado com sucesso" || echo "‚ö†Ô∏è WPScan n√£o p√¥de ser instalado"

# Sn1per
echo "Instalando Sn1per..."
if git clone https://github.com/1N3/Sn1per.git 2>/dev/null; then
    cd Sn1per && sudo ./install.sh && cd ..
    echo "‚úÖ Sn1per instalado com sucesso"
else
    echo "‚ö†Ô∏è Sn1per n√£o p√¥de ser instalado"
fi

# Instalar ferramentas adicionais
echo "[7/10] Instalando ferramentas adicionais..."

# Sublist3r
echo "Instalando Sublist3r..."
if git clone https://github.com/aboul3la/Sublist3r.git 2>/dev/null; then
    cd Sublist3r && pip3 install -r requirements.txt && cd ..
    echo "‚úÖ Sublist3r instalado com sucesso"
else
    echo "‚ö†Ô∏è Sublist3r n√£o p√¥de ser instalado"
fi

# Findomain
echo "Instalando Findomain..."
curl -LO https://github.com/findomain/findomain/releases/latest/download/findomain-linux 2>/dev/null
if [ -f findomain-linux ]; then
    chmod +x findomain-linux
    sudo mv findomain-linux /usr/local/bin/findomain
    echo "‚úÖ Findomain instalado com sucesso"
else
    echo "‚ö†Ô∏è Findomain n√£o p√¥de ser baixado"
fi

# Assetfinder
echo "Instalando Assetfinder..."
go install github.com/tomnomnom/assetfinder@latest 2>/dev/null && echo "‚úÖ Assetfinder instalado com sucesso" || echo "‚ö†Ô∏è Assetfinder n√£o p√¥de ser instalado"

# GitHub Search
echo "Instalando GitHub Search..."
pip3 install github-search 2>/dev/null && echo "‚úÖ GitHub Search instalado com sucesso" || echo "‚ö†Ô∏è GitHub Search n√£o p√¥de ser instalado"

# Gitrob
echo "Instalando Gitrob..."
go install github.com/toniblyx/gitrob@latest 2>/dev/null && echo "‚úÖ Gitrob instalado com sucesso" || echo "‚ö†Ô∏è Gitrob n√£o p√¥de ser instalado"

# MEG
echo "Instalando MEG..."
go install github.com/tomnomnom/meg@latest 2>/dev/null && echo "‚úÖ MEG instalado com sucesso" || echo "‚ö†Ô∏è MEG n√£o p√¥de ser instalado"

# Waymore
echo "Instalando Waymore..."
pip3 install waymore 2>/dev/null && echo "‚úÖ Waymore instalado com sucesso" || echo "‚ö†Ô∏è Waymore n√£o p√¥de ser instalado"

# Unfurl
echo "Instalando Unfurl..."
go install github.com/tomnomnom/unfurl@latest 2>/dev/null && echo "‚úÖ Unfurl instalado com sucesso" || echo "‚ö†Ô∏è Unfurl n√£o p√¥de ser instalado"

# Dalfox
echo "Instalando Dalfox..."
go install github.com/hahwul/dalfox/v2@latest 2>/dev/null && echo "‚úÖ Dalfox instalado com sucesso" || echo "‚ö†Ô∏è Dalfox n√£o p√¥de ser instalado"

# Gospider
echo "Instalando Gospider..."
go install github.com/jaeles-project/gospider@latest 2>/dev/null && echo "‚úÖ Gospider instalado com sucesso" || echo "‚ö†Ô∏è Gospider n√£o p√¥de ser instalado"

# Recon-ng
echo "Instalando Recon-ng..."
pip3 install recon-ng 2>/dev/null && echo "‚úÖ Recon-ng instalado com sucesso" || echo "‚ö†Ô∏è Recon-ng n√£o p√¥de ser instalado"

# Spiderfoot
echo "Instalando Spiderfoot..."
pip3 install spiderfoot 2>/dev/null && echo "‚úÖ Spiderfoot instalado com sucesso" || echo "‚ö†Ô∏è Spiderfoot n√£o p√¥de ser instalado"

# Shodan CLI
echo "Instalando Shodan CLI..."
pip3 install shodan 2>/dev/null && echo "‚úÖ Shodan CLI instalado com sucesso" || echo "‚ö†Ô∏è Shodan CLI n√£o p√¥de ser instalado"

# Censys
echo "Instalando Censys..."
pip3 install censys 2>/dev/null && echo "‚úÖ Censys instalado com sucesso" || echo "‚ö†Ô∏è Censys n√£o p√¥de ser instalado"

# Wafw00f
echo "Instalando Wafw00f..."
pip3 install wafw00f 2>/dev/null && echo "‚úÖ Wafw00f instalado com sucesso" || echo "‚ö†Ô∏è Wafw00f n√£o p√¥de ser instalado"

# Vhost
echo "Instalando Vhost..."
go install github.com/hakluke/hakvhost@latest 2>/dev/null && echo "‚úÖ Vhost instalado com sucesso" || echo "‚ö†Ô∏è Vhost n√£o p√¥de ser instalado"

# GF patterns
echo "Instalando GF patterns..."
mkdir -p ~/.gf
if git clone https://github.com/tomnomnom/gf.git 2>/dev/null; then
    cp -r gf/examples/* ~/.gf/
    rm -rf gf
    echo "‚úÖ GF patterns instalado com sucesso"
else
    echo "‚ö†Ô∏è GF patterns n√£o p√¥de ser instalado"
fi

# Git-secrets
echo "Instalando Git-secrets..."
if git clone https://github.com/awslabs/git-secrets.git 2>/dev/null; then
    cd git-secrets && sudo make install && cd ..
    echo "‚úÖ Git-secrets instalado com sucesso"
else
    echo "‚ö†Ô∏è Git-secrets n√£o p√¥de ser instalado"
fi

# Shuffledns
echo "Instalando Shuffledns..."
go install github.com/projectdiscovery/shuffledns/cmd/shuffledns@latest 2>/dev/null && echo "‚úÖ Shuffledns instalado com sucesso" || echo "‚ö†Ô∏è Shuffledns n√£o p√¥de ser instalado"

# DNSgen
echo "Instalando DNSgen..."
pip3 install dnsgen 2>/dev/null && echo "‚úÖ DNSgen instalado com sucesso" || echo "‚ö†Ô∏è DNSgen n√£o p√¥de ser instalado"

# Mapcidr
echo "Instalando Mapcidr..."
go install github.com/projectdiscovery/mapcidr/cmd/mapcidr@latest 2>/dev/null && echo "‚úÖ Mapcidr instalado com sucesso" || echo "‚ö†Ô∏è Mapcidr n√£o p√¥de ser instalado"

# TKO-subs
echo "Instalando TKO-subs..."
if git clone https://github.com/anshumanbh/tko-subs.git 2>/dev/null; then
    cd tko-subs && pip3 install -r requirements.txt && cd ..
    echo "‚úÖ TKO-subs instalado com sucesso"
else
    echo "‚ö†Ô∏è TKO-subs n√£o p√¥de ser instalado"
fi

# GitHub-dorker
echo "Instalando GitHub-dorker..."
pip3 install github-dorker 2>/dev/null && echo "‚úÖ GitHub-dorker instalado com sucesso" || echo "‚ö†Ô∏è GitHub-dorker n√£o p√¥de ser instalado"

# Gfredirect
echo "Instalando Gfredirect..."
go install github.com/tomnomnom/gfredirect@latest 2>/dev/null && echo "‚úÖ Gfredirect instalado com sucesso" || echo "‚ö†Ô∏è Gfredirect n√£o p√¥de ser instalado"

# Paramspider
echo "Instalando Paramspider..."
pip3 install paramspider 2>/dev/null && echo "‚úÖ Paramspider instalado com sucesso" || echo "‚ö†Ô∏è Paramspider n√£o p√¥de ser instalado"

# Aquatone
echo "Instalando Aquatone..."
wget https://github.com/michenriksen/aquatone/releases/download/v1.7.0/aquatone_linux_amd64_1.7.0.zip 2>/dev/null
if [ -f aquatone_linux_amd64_1.7.0.zip ]; then
    unzip aquatone_linux_amd64_1.7.0.zip
    sudo mv aquatone /usr/local/bin/
    rm aquatone_linux_amd64_1.7.0.zip
    echo "‚úÖ Aquatone instalado com sucesso"
else
    echo "‚ö†Ô∏è Aquatone n√£o p√¥de ser baixado"
fi

# Criar diret√≥rios necess√°rios
echo "[8/10] Criando diret√≥rios..."
mkdir -p ~/tools
mkdir -p ~/wordlists
mkdir -p ~/results

# Baixar wordlists adicionais
echo "[9/10] Baixando wordlists..."
cd ~/wordlists

# SecLists (j√° instalado via apt)
# Baixar wordlists adicionais se necess√°rio
wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/DNS/subdomains-top1million-5000.txt 2>/dev/null || echo "‚ö†Ô∏è Wordlist DNS n√£o p√¥de ser baixada"
wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/common.txt 2>/dev/null || echo "‚ö†Ô∏è Wordlist common n√£o p√¥de ser baixada"
wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/big.txt 2>/dev/null || echo "‚ö†Ô∏è Wordlist big n√£o p√¥de ser baixada"

cd ~

# Configurar PATH final
echo "[10/10] Configurando PATH..."
echo 'export PATH=$PATH:$HOME/go/bin' >> ~/.bashrc
echo 'export PATH=$PATH:/usr/local/bin' >> ~/.bashrc
source ~/.bashrc

echo ""
echo "‚úÖ Instala√ß√£o conclu√≠da!"
echo "=================================================="
echo "üîß Ferramentas instaladas:"
echo "   - Enumera√ß√£o: Amass, Subfinder, Assetfinder, Findomain"
echo "   - Verifica√ß√£o: Httpx, Nmap, Whatweb"
echo "   - URLs: Waybackurls, Gau, Hakrawler"
echo "   - Fuzzing: Ffuf, Gobuster, Dirb"
echo "   - DNS: Dnsrecon, Dnsenum, Fierce"
echo "   - Screenshots: Gowitness, Aquatone"
echo "   - Vulnerabilidades: Nuclei, WPScan, XSStrike"
echo "   - Par√¢metros: Arjun, Paramspider"
echo "   - Cloud: Cloud_enum"
echo ""
echo "üìÅ Diret√≥rios criados:"
echo "   - ~/tools/ - Ferramentas adicionais"
echo "   - ~/wordlists/ - Wordlists"
echo "   - ~/results/ - Resultados"
echo ""
echo "üîÑ Para aplicar as mudan√ßas, execute:"
echo "   source ~/.bashrc"
echo ""
echo "üöÄ Agora voc√™ pode usar o script enum.sh!"
echo ""
echo "‚ö†Ô∏è Algumas ferramentas podem n√£o ter sido instaladas devido a problemas de acesso."
echo "   Execute ./verificar_instalacao.sh para verificar quais est√£o dispon√≠veis."
